<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zonebrite Solutions - Monthly Maintenance Report Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary-blue: #2c5aa0;
            --secondary-blue: #4a90e2;
            --dark-gray: #333333;
            --medium-gray: #666666;
            --light-gray: #f5f5f5;
            --border-gray: #dddddd;
            --success-green: #28a745;
            --warning-orange: #fd7e14;
            --danger-red: #dc3545;
            --info-blue: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Barlow', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Header Styles */
        .header {
            text-align: center;
            border-bottom: 3px solid var(--primary-blue);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-blue);
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .tagline {
            font-size: 16px;
            color: var(--medium-gray);
            font-weight: 400;
            font-style: italic;
            margin-bottom: 15px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--dark-gray);
            margin-top: 10px;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--light-gray);
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .status-item {
            font-size: 14px;
            color: var(--medium-gray);
        }

        .status-item strong {
            color: var(--dark-gray);
        }

        .progress-bar-container {
            flex: 1;
            min-width: 200px;
            margin: 0 20px;
        }

        .progress-label {
            font-size: 12px;
            color: var(--medium-gray);
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-blue), var(--primary-blue));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 40px;
            border-left: 4px solid var(--primary-blue);
            padding-left: 20px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-number {
            background-color: var(--primary-blue);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
        }

        /* Form Groups */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-size: 14px;
            font-weight: 500;
            color: var(--dark-gray);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .required {
            color: var(--danger-red);
            font-weight: 700;
        }

        .tooltip {
            font-size: 12px;
            color: var(--medium-gray);
            font-weight: 400;
            font-style: italic;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        input[type="month"],
        select,
        textarea {
            padding: 10px 12px;
            border: 1px solid var(--border-gray);
            border-radius: 4px;
            font-family: 'Barlow', sans-serif;
            font-size: 14px;
            color: var(--dark-gray);
            background-color: white;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        input.error,
        select.error,
        textarea.error {
            border-color: var(--danger-red);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .error-message {
            color: var(--danger-red);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        input.error + .error-message,
        select.error + .error-message,
        textarea.error + .error-message {
            display: block;
        }

        /* Checkbox Styles */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .checkbox-item:hover {
            background-color: var(--light-gray);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        /* Range Slider */
        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--success-green) 0%, var(--warning-orange) 70%, var(--danger-red) 100%);
            outline: none;
        }

        .range-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-blue);
            min-width: 50px;
            text-align: right;
        }

        /* Dynamic Sections */
        .dynamic-item {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            position: relative;
        }

        .dynamic-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-number {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .remove-btn {
            background-color: var(--danger-red);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Barlow', sans-serif;
            font-size: 13px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .remove-btn:hover {
            background-color: #c82333;
        }

        .add-btn {
            background-color: var(--secondary-blue);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Barlow', sans-serif;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn:hover {
            background-color: var(--primary-blue);
        }

        .add-btn::before {
            content: "+";
            font-size: 18px;
            font-weight: 700;
        }

        /* Status Indicators */
        .status-excellent { color: var(--success-green); }
        .status-good { color: var(--info-blue); }
        .status-attention { color: var(--warning-orange); }
        .status-critical { color: var(--danger-red); }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--border-gray);
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            font-family: 'Barlow', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            box-shadow: 0 4px 6px rgba(44, 90, 160, 0.3);
        }

        .btn-primary:hover {
            background-color: #234780;
            box-shadow: 0 6px 12px rgba(44, 90, 160, 0.4);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--medium-gray);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--dark-gray);
        }

        .btn-danger {
            background-color: white;
            color: var(--danger-red);
            border: 2px solid var(--danger-red);
        }

        .btn-danger:hover {
            background-color: var(--danger-red);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }

        .modal-body {
            margin-bottom: 20px;
            color: var(--medium-gray);
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-buttons .btn {
            padding: 10px 20px;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .logo {
                font-size: 28px;
            }

            .page-title {
                font-size: 22px;
            }

            .status-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .progress-bar-container {
                width: 100%;
                margin: 10px 0;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Auto-save indicator */
        .save-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: var(--success-green);
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .save-indicator.show {
            opacity: 1;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ZONEBRITE SOLUTIONS</div>
            <div class="tagline">Protecting What Matters Most</div>
            <div class="page-title">Monthly Maintenance Report Generator</div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <strong>Last Saved:</strong> <span id="lastSaved">Never</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-label">Form Progress: <span id="progressText">0%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="save-indicator" id="saveIndicator">
                âœ“ Saved
            </div>
        </div>

        <!-- Form -->
        <form id="maintenanceForm">
            <!-- Section 1: Report Header -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">1</span>
                    Report Header
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Report Month/Year <span class="required">*</span></label>
                        <input type="month" name="reportMonth" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Report Generated Date <span class="required">*</span></label>
                        <input type="date" name="reportDate" required>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Client Business Name <span class="required">*</span></label>
                        <input type="text" name="clientName" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Property Address <span class="required">*</span></label>
                        <input type="text" name="propertyAddress" required>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Technician Name <span class="required">*</span></label>
                        <input type="text" name="technicianName" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Service Date(s) Completed <span class="required">*</span></label>
                        <input type="date" name="serviceDate" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Next Scheduled Maintenance <span class="required">*</span></label>
                        <input type="date" name="nextMaintenance" required>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
            </div>

            <!-- Section 2: System Health Overview -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">2</span>
                    System Health Overview
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Overall System Status <span class="required">*</span></label>
                        <select name="systemStatus" required>
                            <option value="">Select Status</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Needs Attention">Needs Attention</option>
                            <option value="Critical">Critical</option>
                        </select>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Network Connectivity Status <span class="required">*</span></label>
                        <select name="networkStatus" required>
                            <option value="">Select Status</option>
                            <option value="Stable">Stable</option>
                            <option value="Intermittent">Intermittent</option>
                            <option value="Issues Detected">Issues Detected</option>
                        </select>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Total Cameras in System <span class="required">*</span></label>
                        <input type="number" name="totalCameras" min="0" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Cameras Operational <span class="required">*</span></label>
                        <input type="number" name="camerasOperational" min="0" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Cameras Requiring Attention</label>
                        <input type="number" name="camerasAttention" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>System Uptime Percentage <span class="required">*</span></label>
                        <input type="number" name="uptime" min="0" max="100" step="0.01" required>
                        <span class="error-message">This field is required (0-100)</span>
                    </div>
                    <div class="form-group">
                        <label>Storage Days Remaining <span class="required">*</span></label>
                        <input type="number" name="storageDays" min="0" required>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Recording Storage Used <span class="required">*</span></label>
                        <div class="range-container">
                            <input type="range" name="storageUsed" min="0" max="100" value="50" required>
                            <span class="range-value"><span id="storageValue">50</span>%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Maintenance Activities Completed -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">3</span>
                    Maintenance Activities Completed
                </h2>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity1" name="activities" value="Camera lens cleaning">
                        <label for="activity1">Camera lens cleaning</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity2" name="activities" value="Camera housing inspection">
                        <label for="activity2">Camera housing inspection</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity3" name="activities" value="Camera angle/positioning verification">
                        <label for="activity3">Camera angle/positioning verification</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity4" name="activities" value="Recording quality verification">
                        <label for="activity4">Recording quality verification</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity5" name="activities" value="Playback functionality test">
                        <label for="activity5">Playback functionality test</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity6" name="activities" value="Storage device health check">
                        <label for="activity6">Storage device health check</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity7" name="activities" value="Network connection verification">
                        <label for="activity7">Network connection verification</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity8" name="activities" value="Firmware/software updates applied">
                        <label for="activity8">Firmware/software updates applied</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity9" name="activities" value="Power supply inspection">
                        <label for="activity9">Power supply inspection</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity10" name="activities" value="Cable and connection inspection">
                        <label for="activity10">Cable and connection inspection</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity11" name="activities" value="Access control system test">
                        <label for="activity11">Access control system test (if applicable)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity12" name="activities" value="Remote viewing functionality test">
                        <label for="activity12">Remote viewing functionality test</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity13" name="activities" value="Motion detection calibration">
                        <label for="activity13">Motion detection calibration</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity14" name="activities" value="Night vision verification">
                        <label for="activity14">Night vision verification</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity15" name="activities" value="Weatherproofing inspection">
                        <label for="activity15">Weatherproofing inspection (outdoor cameras)</label>
                    </div>
                </div>
            </div>

            <!-- Section 4: Individual Camera Status -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">4</span>
                    Individual Camera Status
                </h2>
                <div id="camerasContainer">
                    <!-- Dynamic camera entries will be added here -->
                </div>
                <button type="button" class="add-btn" onclick="addCamera()">Add Camera</button>
            </div>

            <!-- Section 5: Issues Identified & Resolved -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">5</span>
                    Issues Identified & Resolved
                </h2>
                <div id="issuesContainer">
                    <!-- Dynamic issue entries will be added here -->
                </div>
                <button type="button" class="add-btn" onclick="addIssue()">Add Issue</button>
            </div>

            <!-- Section 6: Recommendations -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">6</span>
                    Recommendations
                </h2>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Maintenance Recommendations</label>
                        <textarea name="maintenanceRec" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Upgrade Opportunities</label>
                        <textarea name="upgradeOpp" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>System Optimization Suggestions</label>
                        <textarea name="optimizationSug" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Estimated Cost (if applicable)</label>
                        <input type="text" name="estimatedCost" placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label>Priority Level</label>
                        <select name="priorityLevel">
                            <option value="">Select Priority</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Section 7: Storage & Recording Details -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">7</span>
                    Storage & Recording Details
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Total Storage Capacity <span class="required">*</span></label>
                        <input type="text" name="storageCapacity" placeholder="e.g., 2TB" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Current Storage Used <span class="required">*</span></label>
                        <input type="text" name="storageCurrentlyUsed" placeholder="e.g., 1.2TB" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Recording Retention Period (days) <span class="required">*</span></label>
                        <input type="number" name="retentionPeriod" min="0" required>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Video Quality Settings <span class="required">*</span></label>
                        <select name="videoQuality" required>
                            <option value="">Select Quality</option>
                            <option value="4K">4K</option>
                            <option value="1080p">1080p</option>
                            <option value="720p">720p</option>
                            <option value="Custom">Custom</option>
                        </select>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Backup Status <span class="required">*</span></label>
                        <select name="backupStatus" required>
                            <option value="">Select Status</option>
                            <option value="Active">Active</option>
                            <option value="Not Configured">Not Configured</option>
                            <option value="Failed">Failed</option>
                        </select>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
            </div>

            <!-- Section 8: System Updates -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">8</span>
                    System Updates
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Current Firmware Version</label>
                        <input type="text" name="firmwareVersion">
                    </div>
                    <div class="form-group">
                        <label>Current Software Version</label>
                        <input type="text" name="softwareVersion">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Updates Applied This Month</label>
                        <textarea name="updatesApplied" rows="3"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Updates Recommended</label>
                        <textarea name="updatesRecommended" rows="3"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 9: Summary -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">9</span>
                    Summary
                </h2>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Overall Assessment <span class="required">*</span></label>
                        <textarea name="overallAssessment" rows="4" required></textarea>
                        <span class="error-message">This field is required</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Critical Items Requiring Immediate Attention</label>
                        <textarea name="criticalItems" rows="3"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Next Month's Focus Areas</label>
                        <textarea name="focusAreas" rows="3"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 10: Sign-off -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-number">10</span>
                    Sign-off
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Technician Signature/Name <span class="required">*</span></label>
                        <input type="text" name="techSignature" required>
                        <span class="error-message">This field is required</span>
                    </div>
                    <div class="form-group">
                        <label>Client Acknowledgment Name (optional)</label>
                        <input type="text" name="clientAck">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Client Notes/Feedback (optional)</label>
                        <textarea name="clientFeedback" rows="3"></textarea>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" onclick="generatePDF()">Generate PDF</button>
                <button type="button" class="btn btn-secondary" onclick="saveFormData()">Save Progress</button>
                <button type="button" class="btn btn-danger" onclick="showClearConfirmation()">Clear Form</button>
            </div>
        </form>
    </div>

    <!-- Restore Session Modal -->
    <div id="restoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Restore Previous Session?</div>
            <div class="modal-body">
                We found a previously saved report. Would you like to restore it and continue where you left off?
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeRestoreModal()">Start Fresh</button>
                <button class="btn btn-primary" onclick="restoreSession()">Restore</button>
            </div>
        </div>
    </div>

    <!-- Clear Confirmation Modal -->
    <div id="clearModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Clear All Data?</div>
            <div class="modal-body">
                Are you sure you want to clear all form data? This action cannot be undone.
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeClearModal()">Cancel</button>
                <button class="btn btn-danger" onclick="clearForm()">Clear All</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let cameraCount = 0;
        let issueCount = 0;
        let autoSaveInterval;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('[name="reportDate"]').value = today;

            // Calculate next maintenance date (30 days from today)
            const nextMonth = new Date();
            nextMonth.setDate(nextMonth.getDate() + 30);
            document.querySelector('[name="nextMaintenance"]').value = nextMonth.toISOString().split('T')[0];

            // Check for saved data
            if (localStorage.getItem('reportData')) {
                document.getElementById('restoreModal').style.display = 'block';
            } else {
                // Add initial camera and issue
                addCamera();
                addIssue();
            }

            // Set up auto-save
            autoSaveInterval = setInterval(autoSave, 30000); // Every 30 seconds

            // Add event listeners for auto-save on blur
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('blur', autoSave);
            });

            // Update storage slider value display
            const storageSlider = document.querySelector('[name="storageUsed"]');
            storageSlider.addEventListener('input', function() {
                document.getElementById('storageValue').textContent = this.value;
            });

            // Auto-calculate cameras requiring attention
            const totalCamerasInput = document.querySelector('[name="totalCameras"]');
            const operationalCamerasInput = document.querySelector('[name="camerasOperational"]');

            function updateCamerasAttention() {
                const total = parseInt(totalCamerasInput.value) || 0;
                const operational = parseInt(operationalCamerasInput.value) || 0;
                document.querySelector('[name="camerasAttention"]').value = Math.max(0, total - operational);
                updateProgress();
            }

            totalCamerasInput.addEventListener('input', updateCamerasAttention);
            operationalCamerasInput.addEventListener('input', updateCamerasAttention);

            // Update progress on any form change
            document.getElementById('maintenanceForm').addEventListener('input', updateProgress);
            document.getElementById('maintenanceForm').addEventListener('change', updateProgress);

            // Initial progress update
            updateProgress();
        });

        // Add Camera
        function addCamera() {
            cameraCount++;
            const container = document.getElementById('camerasContainer');
            const cameraDiv = document.createElement('div');
            cameraDiv.className = 'dynamic-item';
            cameraDiv.id = `camera-${cameraCount}`;
            cameraDiv.innerHTML = `
                <div class="dynamic-item-header">
                    <span class="item-number">Camera #${cameraCount}</span>
                    <button type="button" class="remove-btn" onclick="removeCamera(${cameraCount})">Remove</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Camera Location/Name</label>
                        <input type="text" name="camera_${cameraCount}_location">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="camera_${cameraCount}_status">
                            <option value="">Select Status</option>
                            <option value="Operational">Operational</option>
                            <option value="Needs Attention">Needs Attention</option>
                            <option value="Offline">Offline</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Issues Found (optional)</label>
                        <textarea name="camera_${cameraCount}_issues" rows="2"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Actions Taken (optional)</label>
                        <textarea name="camera_${cameraCount}_actions" rows="2"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Notes (optional)</label>
                        <textarea name="camera_${cameraCount}_notes" rows="2"></textarea>
                    </div>
                </div>
            `;
            container.appendChild(cameraDiv);
            updateProgress();
        }

        // Remove Camera
        function removeCamera(id) {
            const element = document.getElementById(`camera-${id}`);
            if (element) {
                element.remove();
                updateProgress();
            }
        }

        // Add Issue
        function addIssue() {
            issueCount++;
            const container = document.getElementById('issuesContainer');
            const issueDiv = document.createElement('div');
            issueDiv.className = 'dynamic-item';
            issueDiv.id = `issue-${issueCount}`;
            issueDiv.innerHTML = `
                <div class="dynamic-item-header">
                    <span class="item-number">Issue #${issueCount}</span>
                    <button type="button" class="remove-btn" onclick="removeIssue(${issueCount})">Remove</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Severity</label>
                        <select name="issue_${issueCount}_severity">
                            <option value="">Select Severity</option>
                            <option value="Low">Low</option>
                            <option value="Medium">Medium</option>
                            <option value="High">High</option>
                            <option value="Critical">Critical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Parts Replaced (optional)</label>
                        <input type="text" name="issue_${issueCount}_parts">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Issue Description</label>
                        <textarea name="issue_${issueCount}_description" rows="2"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Resolution</label>
                        <textarea name="issue_${issueCount}_resolution" rows="2"></textarea>
                    </div>
                </div>
            `;
            container.appendChild(issueDiv);
            updateProgress();
        }

        // Remove Issue
        function removeIssue(id) {
            const element = document.getElementById(`issue-${id}`);
            if (element) {
                element.remove();
                updateProgress();
            }
        }

        // Update Progress
        function updateProgress() {
            const form = document.getElementById('maintenanceForm');
            const requiredFields = form.querySelectorAll('[required]');
            let filledCount = 0;

            requiredFields.forEach(field => {
                if (field.type === 'checkbox') {
                    // For checkboxes, check if any in the group are checked
                    const checkboxes = form.querySelectorAll('[name="' + field.name + '"]');
                    const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
                    if (anyChecked) filledCount++;
                } else if (field.value.trim() !== '') {
                    filledCount++;
                }
            });

            const percentage = Math.round((filledCount / requiredFields.length) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        // Save Form Data
        function saveFormData() {
            const formData = getFormData();
            localStorage.setItem('reportData', JSON.stringify(formData));
            localStorage.setItem('lastSaved', new Date().toISOString());
            updateLastSavedDisplay();
            showSaveIndicator();
        }

        // Auto-save
        function autoSave() {
            saveFormData();
        }

        // Get Form Data
        function getFormData() {
            const form = document.getElementById('maintenanceForm');
            const formData = new FormData(form);
            const data = {};

            // Get all form elements
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Handle multiple values (checkboxes)
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }

            // Get all checkboxes (including unchecked)
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                if (!data[cb.name]) {
                    data[cb.name] = [];
                }
            });

            // Store counts for dynamic sections
            data.cameraCount = cameraCount;
            data.issueCount = issueCount;

            return data;
        }

        // Set Form Data
        function setFormData(data) {
            const form = document.getElementById('maintenanceForm');

            // Restore camera and issue counts
            if (data.cameraCount) {
                for (let i = 1; i <= data.cameraCount; i++) {
                    if (data[`camera_${i}_location`] !== undefined) {
                        addCamera();
                    }
                }
            }

            if (data.issueCount) {
                for (let i = 1; i <= data.issueCount; i++) {
                    if (data[`issue_${i}_description`] !== undefined) {
                        addIssue();
                    }
                }
            }

            // Populate form fields
            for (let key in data) {
                const element = form.querySelector(`[name="${key}"]`);
                if (element) {
                    if (element.type === 'checkbox') {
                        const checkboxes = form.querySelectorAll(`[name="${key}"]`);
                        const values = Array.isArray(data[key]) ? data[key] : [data[key]];
                        checkboxes.forEach(cb => {
                            cb.checked = values.includes(cb.value);
                        });
                    } else {
                        element.value = data[key];
                    }
                }
            }

            updateProgress();
        }

        // Show Save Indicator
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Update Last Saved Display
        function updateLastSavedDisplay() {
            const lastSaved = localStorage.getItem('lastSaved');
            if (lastSaved) {
                const date = new Date(lastSaved);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000); // seconds

                let displayText;
                if (diff < 60) {
                    displayText = 'Just now';
                } else if (diff < 3600) {
                    const minutes = Math.floor(diff / 60);
                    displayText = `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                } else {
                    displayText = date.toLocaleString();
                }

                document.getElementById('lastSaved').textContent = displayText;
            }
        }

        // Update last saved display every minute
        setInterval(updateLastSavedDisplay, 60000);

        // Restore Session
        function restoreSession() {
            const savedData = localStorage.getItem('reportData');
            if (savedData) {
                const data = JSON.parse(savedData);
                setFormData(data);
                updateLastSavedDisplay();
            }
            closeRestoreModal();
        }

        // Close Restore Modal
        function closeRestoreModal() {
            document.getElementById('restoreModal').style.display = 'none';
            // Add initial camera and issue if starting fresh
            if (cameraCount === 0) addCamera();
            if (issueCount === 0) addIssue();
        }

        // Show Clear Confirmation
        function showClearConfirmation() {
            document.getElementById('clearModal').style.display = 'block';
        }

        // Close Clear Modal
        function closeClearModal() {
            document.getElementById('clearModal').style.display = 'none';
        }

        // Clear Form
        function clearForm() {
            if (confirm('Are you absolutely sure? This will delete all data permanently.')) {
                document.getElementById('maintenanceForm').reset();
                localStorage.removeItem('reportData');
                localStorage.removeItem('lastSaved');

                // Clear dynamic sections
                document.getElementById('camerasContainer').innerHTML = '';
                document.getElementById('issuesContainer').innerHTML = '';
                cameraCount = 0;
                issueCount = 0;

                // Add initial items
                addCamera();
                addIssue();

                // Reset displays
                document.getElementById('lastSaved').textContent = 'Never';
                updateProgress();
                closeClearModal();
            }
        }

        // Validate Form
        function validateForm() {
            const form = document.getElementById('maintenanceForm');
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });

            if (!isValid) {
                alert('Please fill in all required fields (marked with *)');
                // Scroll to first error
                const firstError = form.querySelector('.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return isValid;
        }

        // Generate PDF
        function generatePDF() {
            if (!validateForm()) {
                return;
            }

            // Show loading indicator
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Generating PDF<span class="spinner"></span>';
            btn.disabled = true;

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                const formData = getFormData();
                let yPos = 20;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                const maxWidth = 170;

                // Helper function to add cover page
                function addCoverPage() {
                    // Background gradient effect (using rectangles)
                    doc.setFillColor(44, 90, 160);
                    doc.rect(0, 0, 210, 80, 'F');
                    doc.setFillColor(74, 144, 226);
                    doc.rect(0, 80, 210, 40, 'F');

                    // Company name with modern styling
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(32);
                    doc.setFont(undefined, 'bold');
                    doc.text('ZONEBRITE', 105, 50, { align: 'center' });
                    doc.setFontSize(28);
                    doc.text('SOLUTIONS', 105, 62, { align: 'center' });

                    // Tagline
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'italic');
                    doc.text('Protecting What Matters Most', 105, 73, { align: 'center' });

                    // White accent line
                    doc.setDrawColor(255, 255, 255);
                    doc.setLineWidth(2);
                    doc.line(60, 85, 150, 85);

                    // Report title box
                    doc.setFillColor(255, 255, 255);
                    doc.roundedRect(30, 130, 150, 50, 3, 3, 'F');
                    doc.setDrawColor(44, 90, 160);
                    doc.setLineWidth(0.5);
                    doc.roundedRect(30, 130, 150, 50, 3, 3, 'S');

                    doc.setTextColor(44, 90, 160);
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('MONTHLY MAINTENANCE', 105, 148, { align: 'center' });
                    doc.setFontSize(18);
                    doc.text('REPORT', 105, 160, { align: 'center' });

                    // Client information box
                    doc.setFillColor(245, 245, 245);
                    doc.roundedRect(30, 200, 150, 40, 3, 3, 'F');

                    doc.setTextColor(51, 51, 51);
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('CLIENT:', 40, 212);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(11);
                    doc.text(formData.clientName || 'N/A', 40, 220);

                    doc.setFont(undefined, 'bold');
                    doc.setFontSize(12);
                    doc.text('REPORT PERIOD:', 40, 232);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(11);
                    let reportPeriod = 'N/A';
                    if (formData.reportMonth) {
                        const date = new Date(formData.reportMonth + '-01');
                        reportPeriod = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    }
                    doc.text(reportPeriod, 40, 240);

                    // Bottom footer on cover
                    doc.setFontSize(8);
                    doc.setTextColor(102, 102, 102);
                    doc.text('Generated on: ' + new Date().toLocaleDateString(), 105, 270, { align: 'center' });
                    doc.text('Zonebrite Solutions | Phone: Contact for details', 105, 276, { align: 'center' });
                    doc.text('Email: info@zonebrite.com | www.zonebrite.com', 105, 282, { align: 'center' });
                }

                // Helper function to add page header
                function addHeader() {
                    // Modern header with gradient bar
                    doc.setFillColor(44, 90, 160);
                    doc.rect(0, 0, 210, 12, 'F');

                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('ZONEBRITE SOLUTIONS', 20, 8);

                    doc.setFontSize(8);
                    doc.setFont(undefined, 'normal');
                    doc.text('Monthly Maintenance Report', 165, 8);

                    // Subtle separator line
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.line(margin, 15, 210 - margin, 15);
                }

                // Helper function to add page footer
                function addFooter(pageNum) {
                    const footerY = pageHeight - 15;

                    // Footer separator line
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.line(margin, footerY - 3, 210 - margin, footerY - 3);

                    // Page number in a subtle badge
                    doc.setFillColor(245, 245, 245);
                    doc.roundedRect(98, footerY, 14, 6, 1, 1, 'F');
                    doc.setFontSize(8);
                    doc.setTextColor(102, 102, 102);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${pageNum}`, 105, footerY + 4, { align: 'center' });

                    // Contact information
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(120, 120, 120);
                    doc.text('Phone: Contact for details', 40, footerY + 10);
                    doc.text('Email: info@zonebrite.com', 95, footerY + 10);
                    doc.text('www.zonebrite.com', 155, footerY + 10);
                }

                // Helper function to check if we need a new page
                function checkNewPage(neededSpace) {
                    if (yPos + neededSpace > pageHeight - 20) {
                        addFooter(pageNum);
                        doc.addPage();
                        pageNum++;
                        addHeader();
                        yPos = 50;
                        return true;
                    }
                    return false;
                }

                // Helper function to add section title
                function addSectionTitle(title) {
                    checkNewPage(20);

                    // Modern section header with colored background
                    doc.setFillColor(44, 90, 160);
                    doc.roundedRect(margin - 2, yPos - 5, 210 - 2 * margin + 4, 10, 2, 2, 'F');

                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(255, 255, 255);
                    doc.text(title, margin + 2, yPos + 1);

                    yPos += 10;
                }

                // Helper function to add status badge
                function addStatusBadge(status, x, y) {
                    const colors = {
                        'Excellent': { bg: [40, 167, 69], text: [255, 255, 255] },
                        'Good': { bg: [23, 162, 184], text: [255, 255, 255] },
                        'Operational': { bg: [40, 167, 69], text: [255, 255, 255] },
                        'Stable': { bg: [23, 162, 184], text: [255, 255, 255] },
                        'Needs Attention': { bg: [253, 126, 20], text: [255, 255, 255] },
                        'Intermittent': { bg: [253, 126, 20], text: [255, 255, 255] },
                        'Critical': { bg: [220, 53, 69], text: [255, 255, 255] },
                        'Offline': { bg: [220, 53, 69], text: [255, 255, 255] },
                        'Issues Detected': { bg: [220, 53, 69], text: [255, 255, 255] }
                    };

                    const color = colors[status] || { bg: [200, 200, 200], text: [51, 51, 51] };

                    // Draw badge background
                    doc.setFillColor(...color.bg);
                    doc.roundedRect(x, y - 4, doc.getTextWidth(status) + 6, 6, 1, 1, 'F');

                    // Draw text
                    doc.setTextColor(...color.text);
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'bold');
                    doc.text(status, x + 3, y);
                }

                // Helper function to add field
                function addField(label, value, color = [51, 51, 51], isStatus = false) {
                    checkNewPage(10);
                    doc.setFontSize(9);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(85, 85, 85);
                    doc.text(label + ':', margin, yPos);

                    const labelWidth = doc.getTextWidth(label + ': ');

                    if (isStatus && value && value !== 'N/A') {
                        // Use status badge for status fields
                        addStatusBadge(value, margin + labelWidth, yPos);
                        yPos += 7;
                    } else {
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(...color);

                        const valueText = String(value || 'N/A');
                        const lines = doc.splitTextToSize(valueText, maxWidth - labelWidth);
                        doc.text(lines, margin + labelWidth, yPos);

                        yPos += 6 * lines.length;
                    }
                }

                // Helper function to add info box
                function addInfoBox(data) {
                    checkNewPage(25);

                    // Draw rounded box
                    doc.setFillColor(248, 249, 250);
                    doc.setDrawColor(220, 220, 220);
                    doc.setLineWidth(0.3);
                    doc.roundedRect(margin, yPos, 170, data.length * 6 + 8, 2, 2, 'FD');

                    yPos += 6;

                    data.forEach(item => {
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(85, 85, 85);
                        doc.text(item.label + ':', margin + 4, yPos);

                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(51, 51, 51);
                        const labelWidth = doc.getTextWidth(item.label + ': ');
                        doc.text(String(item.value || 'N/A'), margin + 4 + labelWidth, yPos);

                        yPos += 6;
                    });

                    yPos += 4;
                }

                // Helper to get status color
                function getStatusColor(status) {
                    const colors = {
                        'Excellent': [40, 167, 69],
                        'Good': [23, 162, 184],
                        'Operational': [40, 167, 69],
                        'Stable': [23, 162, 184],
                        'Needs Attention': [253, 126, 20],
                        'Intermittent': [253, 126, 20],
                        'Critical': [220, 53, 69],
                        'Offline': [220, 53, 69],
                        'Issues Detected': [220, 53, 69]
                    };
                    return colors[status] || [51, 51, 51];
                }

                let pageNum = 1;

                // Add cover page
                addCoverPage();

                // Start content on new page
                doc.addPage();
                pageNum++;
                addHeader();
                yPos = 20;

                // Section 1: Report Information
                addSectionTitle('ðŸ“‹ REPORT INFORMATION');
                yPos += 2;
                addInfoBox([
                    { label: 'Report Date', value: formData.reportDate },
                    { label: 'Property Address', value: formData.propertyAddress },
                    { label: 'Technician', value: formData.technicianName },
                    { label: 'Service Date', value: formData.serviceDate },
                    { label: 'Next Scheduled Maintenance', value: formData.nextMaintenance }
                ]);
                yPos += 3;

                // Section 2: System Health Overview
                addSectionTitle('ðŸ“Š SYSTEM HEALTH OVERVIEW');
                yPos += 2;
                addField('Overall System Status', formData.systemStatus, getStatusColor(formData.systemStatus), true);
                addField('Network Connectivity', formData.networkStatus, getStatusColor(formData.networkStatus), true);
                yPos += 2;

                // Camera stats in a box
                addInfoBox([
                    { label: 'Total Cameras', value: formData.totalCameras },
                    { label: 'Cameras Operational', value: formData.camerasOperational },
                    { label: 'Cameras Requiring Attention', value: formData.camerasAttention || '0' }
                ]);

                yPos += 2;
                addInfoBox([
                    { label: 'System Uptime', value: formData.uptime + '%' },
                    { label: 'Recording Storage Used', value: formData.storageUsed + '%' },
                    { label: 'Storage Days Remaining', value: formData.storageDays + ' days' }
                ]);
                yPos += 3;

                // Section 3: Maintenance Activities
                addSectionTitle('âœ… MAINTENANCE ACTIVITIES COMPLETED');
                yPos += 2;
                const activities = formData.activities ? (Array.isArray(formData.activities) ? formData.activities : [formData.activities]) : [];
                if (activities.length > 0) {
                    // Split activities into columns for better layout
                    const colWidth = 85;
                    let col = 0;
                    let startY = yPos;

                    activities.forEach((activity, index) => {
                        checkNewPage(6);

                        const xPos = margin + (col * colWidth);

                        // Checkmark icon (green circle with check)
                        doc.setFillColor(40, 167, 69);
                        doc.circle(xPos + 2, yPos - 1.5, 1.5, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(7);
                        doc.text('âœ“', xPos + 0.8, yPos + 0.3);

                        // Activity text
                        doc.setFontSize(8);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(51, 51, 51);
                        const activityText = doc.splitTextToSize(activity, colWidth - 8);
                        doc.text(activityText, xPos + 6, yPos);

                        // Move to next position
                        col++;
                        if (col >= 2) {
                            col = 0;
                            yPos += 6;
                        }
                    });

                    // Adjust yPos if we ended in first column
                    if (col === 1) {
                        yPos += 6;
                    }
                } else {
                    doc.setFontSize(9);
                    doc.setTextColor(150, 150, 150);
                    doc.setFont(undefined, 'italic');
                    doc.text('No activities recorded', margin + 5, yPos);
                    yPos += 5;
                }
                yPos += 5;

                // Section 4: Individual Camera Status
                addSectionTitle('ðŸ“¹ INDIVIDUAL CAMERA STATUS');
                yPos += 2;
                let cameraFound = false;
                for (let i = 1; i <= formData.cameraCount; i++) {
                    const location = formData[`camera_${i}_location`];
                    if (location) {
                        cameraFound = true;
                        checkNewPage(30);

                        // Camera card with border
                        const cardHeight = 28;
                        doc.setFillColor(252, 252, 253);
                        doc.setDrawColor(44, 90, 160);
                        doc.setLineWidth(0.5);
                        doc.roundedRect(margin, yPos, 170, cardHeight, 2, 2, 'FD');

                        yPos += 5;

                        // Camera header with icon
                        doc.setFillColor(44, 90, 160);
                        doc.circle(margin + 4, yPos - 1.5, 2, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text('ðŸ“·', margin + 2.8, yPos + 0.5);

                        doc.setFontSize(10);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(44, 90, 160);
                        doc.text(`Camera #${i}: ${location}`, margin + 9, yPos);

                        const status = formData[`camera_${i}_status`];
                        if (status) {
                            const statusWidth = doc.getTextWidth(`Camera #${i}: ${location}`) + 12;
                            addStatusBadge(status, margin + statusWidth, yPos);
                        }

                        yPos += 7;

                        // Camera details
                        const issues = formData[`camera_${i}_issues`];
                        const actions = formData[`camera_${i}_actions`];
                        const notes = formData[`camera_${i}_notes`];

                        if (issues) {
                            doc.setFontSize(8);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Issues:', margin + 4, yPos);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(51, 51, 51);
                            const issuesText = doc.splitTextToSize(issues, 155);
                            doc.text(issuesText, margin + 18, yPos);
                            yPos += 4 + (issuesText.length - 1) * 4;
                        }

                        if (actions) {
                            doc.setFontSize(8);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Actions:', margin + 4, yPos);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(51, 51, 51);
                            const actionsText = doc.splitTextToSize(actions, 155);
                            doc.text(actionsText, margin + 18, yPos);
                            yPos += 4 + (actionsText.length - 1) * 4;
                        }

                        if (notes) {
                            doc.setFontSize(8);
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Notes:', margin + 4, yPos);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(51, 51, 51);
                            const notesText = doc.splitTextToSize(notes, 155);
                            doc.text(notesText, margin + 18, yPos);
                            yPos += 4 + (notesText.length - 1) * 4;
                        }

                        yPos += 5;
                    }
                }
                if (!cameraFound) {
                    doc.setFontSize(9);
                    doc.setTextColor(150, 150, 150);
                    doc.setFont(undefined, 'italic');
                    doc.text('No camera details recorded', margin + 5, yPos);
                    yPos += 5;
                }
                yPos += 3;

                // Section 5: Issues Identified & Resolved
                addSectionTitle('ðŸ”§ ISSUES IDENTIFIED & RESOLVED');
                yPos += 2;
                let issueFound = false;
                for (let i = 1; i <= formData.issueCount; i++) {
                    const description = formData[`issue_${i}_description`];
                    if (description) {
                        issueFound = true;
                        checkNewPage(28);

                        // Issue card
                        const cardHeight = 26;
                        doc.setFillColor(254, 252, 251);
                        doc.setDrawColor(253, 126, 20);
                        doc.setLineWidth(0.5);
                        doc.roundedRect(margin, yPos, 170, cardHeight, 2, 2, 'FD');

                        yPos += 5;

                        // Issue header
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(220, 53, 69);
                        doc.text(`âš  Issue #${i}`, margin + 4, yPos);

                        const severity = formData[`issue_${i}_severity`];
                        if (severity) {
                            let severityBgColor = [200, 200, 200];
                            if (severity === 'Critical') severityBgColor = [220, 53, 69];
                            else if (severity === 'High') severityBgColor = [253, 126, 20];
                            else if (severity === 'Medium') severityBgColor = [255, 193, 7];
                            else if (severity === 'Low') severityBgColor = [23, 162, 184];

                            // Severity badge
                            doc.setFillColor(...severityBgColor);
                            const badgeWidth = doc.getTextWidth(severity) + 6;
                            doc.roundedRect(margin + 35, yPos - 4, badgeWidth, 6, 1, 1, 'F');
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(8);
                            doc.setFont(undefined, 'bold');
                            doc.text(severity, margin + 38, yPos);
                        }

                        yPos += 7;

                        // Description
                        doc.setFontSize(8);
                        doc.setFont(undefined, 'bold');
                        doc.setTextColor(100, 100, 100);
                        doc.text('Description:', margin + 4, yPos);
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(51, 51, 51);
                        const descText = doc.splitTextToSize(description, 155);
                        doc.text(descText, margin + 27, yPos);
                        yPos += 4 + (descText.length - 1) * 4;

                        const resolution = formData[`issue_${i}_resolution`];
                        if (resolution) {
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Resolution:', margin + 4, yPos);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(40, 167, 69);
                            const resText = doc.splitTextToSize(resolution, 155);
                            doc.text(resText, margin + 27, yPos);
                            yPos += 4 + (resText.length - 1) * 4;
                        }

                        const parts = formData[`issue_${i}_parts`];
                        if (parts) {
                            doc.setFont(undefined, 'bold');
                            doc.setTextColor(100, 100, 100);
                            doc.text('Parts:', margin + 4, yPos);
                            doc.setFont(undefined, 'normal');
                            doc.setTextColor(51, 51, 51);
                            doc.text(parts, margin + 27, yPos);
                            yPos += 4;
                        }

                        yPos += 5;
                    }
                }
                if (!issueFound) {
                    doc.setFontSize(9);
                    doc.setTextColor(150, 150, 150);
                    doc.setFont(undefined, 'italic');
                    doc.text('No issues recorded', margin + 5, yPos);
                    yPos += 5;
                }
                yPos += 3;

                // Section 6: Recommendations
                addSectionTitle('ðŸ’¡ RECOMMENDATIONS');
                yPos += 2;
                if (formData.maintenanceRec || formData.upgradeOpp || formData.optimizationSug) {
                    if (formData.maintenanceRec) {
                        addField('Maintenance Recommendations', formData.maintenanceRec);
                    }
                    if (formData.upgradeOpp) {
                        addField('Upgrade Opportunities', formData.upgradeOpp);
                    }
                    if (formData.optimizationSug) {
                        addField('System Optimization', formData.optimizationSug);
                    }
                    if (formData.estimatedCost || formData.priorityLevel) {
                        yPos += 2;
                        const recData = [];
                        if (formData.estimatedCost) recData.push({ label: 'Estimated Cost', value: formData.estimatedCost });
                        if (formData.priorityLevel) recData.push({ label: 'Priority Level', value: formData.priorityLevel });
                        addInfoBox(recData);
                    }
                } else {
                    doc.setFontSize(9);
                    doc.setTextColor(150, 150, 150);
                    doc.setFont(undefined, 'italic');
                    doc.text('No recommendations at this time', margin + 5, yPos);
                    yPos += 5;
                }
                yPos += 3;

                // Section 7: Storage & Recording
                addSectionTitle('ðŸ’¾ STORAGE & RECORDING DETAILS');
                yPos += 2;
                addInfoBox([
                    { label: 'Total Storage Capacity', value: formData.storageCapacity },
                    { label: 'Current Storage Used', value: formData.storageCurrentlyUsed },
                    { label: 'Recording Retention Period', value: formData.retentionPeriod + ' days' },
                    { label: 'Video Quality Settings', value: formData.videoQuality }
                ]);
                addField('Backup Status', formData.backupStatus, getStatusColor(formData.backupStatus), true);
                yPos += 3;

                // Section 8: System Updates
                addSectionTitle('ðŸ”„ SYSTEM UPDATES');
                yPos += 2;
                if (formData.firmwareVersion || formData.softwareVersion || formData.updatesApplied || formData.updatesRecommended) {
                    if (formData.firmwareVersion || formData.softwareVersion) {
                        const versionData = [];
                        if (formData.firmwareVersion) versionData.push({ label: 'Current Firmware Version', value: formData.firmwareVersion });
                        if (formData.softwareVersion) versionData.push({ label: 'Current Software Version', value: formData.softwareVersion });
                        addInfoBox(versionData);
                    }
                    if (formData.updatesApplied) {
                        addField('Updates Applied This Month', formData.updatesApplied);
                    }
                    if (formData.updatesRecommended) {
                        addField('Updates Recommended', formData.updatesRecommended);
                    }
                } else {
                    doc.setFontSize(9);
                    doc.setTextColor(150, 150, 150);
                    doc.setFont(undefined, 'italic');
                    doc.text('No updates information available', margin + 5, yPos);
                    yPos += 5;
                }
                yPos += 3;

                // Section 9: Summary
                addSectionTitle('ðŸ“ SUMMARY');
                yPos += 2;
                addField('Overall Assessment', formData.overallAssessment);
                if (formData.criticalItems) {
                    yPos += 2;
                    // Critical items box
                    doc.setFillColor(254, 242, 242);
                    doc.setDrawColor(220, 53, 69);
                    doc.setLineWidth(0.5);
                    const criticalText = doc.splitTextToSize(formData.criticalItems, 160);
                    const boxHeight = 8 + criticalText.length * 5;
                    doc.roundedRect(margin, yPos, 170, boxHeight, 2, 2, 'FD');

                    doc.setFontSize(9);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(220, 53, 69);
                    doc.text('âš  CRITICAL ITEMS REQUIRING IMMEDIATE ATTENTION:', margin + 4, yPos + 5);

                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(51, 51, 51);
                    doc.text(criticalText, margin + 4, yPos + 10);
                    yPos += boxHeight + 3;
                }
                if (formData.focusAreas) {
                    addField('Next Month Focus Areas', formData.focusAreas);
                }
                yPos += 3;

                // Section 10: Sign-off
                addSectionTitle('âœï¸ SIGN-OFF');
                yPos += 2;

                // Signature box
                doc.setFillColor(245, 250, 255);
                doc.setDrawColor(44, 90, 160);
                doc.setLineWidth(0.3);
                doc.roundedRect(margin, yPos, 170, 25, 2, 2, 'FD');

                yPos += 5;
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(85, 85, 85);
                doc.text('Technician Signature:', margin + 4, yPos);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(44, 90, 160);
                doc.text(formData.techSignature || 'N/A', margin + 45, yPos);

                yPos += 6;
                if (formData.clientAck) {
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(85, 85, 85);
                    doc.text('Client Acknowledgment:', margin + 4, yPos);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(51, 51, 51);
                    doc.text(formData.clientAck, margin + 45, yPos);
                    yPos += 6;
                }

                if (formData.clientFeedback) {
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(85, 85, 85);
                    doc.text('Client Feedback:', margin + 4, yPos);
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(51, 51, 51);
                    const feedbackText = doc.splitTextToSize(formData.clientFeedback, 155);
                    doc.text(feedbackText, margin + 4, yPos + 5);
                }

                // Add footer to last page
                addFooter(pageNum);

                // Generate filename
                const clientNameClean = (formData.clientName || 'Client').replace(/[^a-zA-Z0-9]/g, '');
                let monthYear = 'Report';
                if (formData.reportMonth) {
                    const date = new Date(formData.reportMonth + '-01');
                    monthYear = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }).replace(' ', '');
                }
                const filename = `${clientNameClean}_MaintenanceReport_${monthYear}.pdf`;

                // Save PDF
                doc.save(filename);

                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;

                alert('PDF generated successfully!');
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please check the console for details.');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
